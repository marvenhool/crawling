# This Python file uses the following encoding: utf-8
# abc
import crawling_module
import time
import random
import urllib2
import exceptions
import string
import re
#####システムのディフォルトコードセットをUTF-８に設定、
#####でないとASCIIコード直接ファイルに書き込みできない可能性が高いですから、エラー出る
import sys
reload(sys)
sys.setdefaultencoding("utf-8")


def proxy_test(proxy_list):

    for proxy in proxy_list:
        buf = get_url_source_by_proxy('http://tabelog.com/tokyo/A1307/A130701/13000005/', proxy, 'UTF-8')
        if buf is None:
            pass
        elif buf.find('アクセスが制限されています') != -1:
            pass
        else:
            crawling_module.write_text_to_file_by_utf8('useful_proxy.csv', proxy, 0)



def get_url_source_by_proxy(url,  proxy_address, charset):
    html = None
    try:
        proxy = {'http': proxy_address}
        proxy_handler = urllib2.ProxyHandler(proxy)
        opener = urllib2.build_opener(proxy_handler)
        urllib2.install_opener(opener)
        html = urllib2.urlopen(url, timeout=5).read() #5 secends time out ,return false
        html = html.decode(charset).encode('utf-8')
    except exceptions.Exception, e:
        print e
        print proxy_address
        html = None
    finally:
        return html

proxy_list = ['http://109.107.133.46:8080','http://117.135.252.14:80','http://117.135.252.14:84','http://118.97.95.182:8080','http://119.40.98.26:8080','http://120.198.243.115:8080','http://120.198.243.115:8888','http://123.94.15.137:80','http://14.139.85.72:8080','http://159.8.36.242:3128','http://178.18.68.178:8080','http://183.207.229.138:8089','http://190.10.156.194:8888','http://190.102.151.231:3128','http://190.120.27.86:8080','http://190.254.1.201:9090','http://195.114.128.12:3128','http://195.114.129.171:3128','http://195.29.77.9:8080','http://202.49.183.14:8080','http://202.65.61.128:8080','http://203.176.140.226:8080','http://41.160.80.194:80','http://41.190.57.175:8080','http://41.205.9.154:8080','http://41.207.40.22:3128','http://41.222.196.52:8080','http://41.77.12.60:8080','http://41.78.208.90:8080','http://41.79.71.40:8080','http://46.99.139.41:3127','http://62.205.216.247:21320','http://80.87.84.186:3128','http://82.144.204.41:3128','http://82.99.180.106:3128','http://85.29.51.15:3128','http://88.132.82.236:8088','http://91.139.246.123:9064','http://93.184.238.145:3128','http://93.191.133.247:4444','http://94.242.238.5:443','http://111.161.126.101:80','http://117.135.194.53:80','http://117.135.252.14:81','http://117.135.252.14:82','http://118.97.180.146:8080','http://123.138.185.50:80','http://125.24.79.197:8080','http://182.253.33.129:3128','http://182.93.218.134:8080','http://183.207.224.42:80','http://183.207.224.45:80','http://183.207.224.50:84','http://183.207.224.51:80','http://183.207.224.51:84','http://183.207.224.51:86','http://183.207.224.52:80','http://183.207.224.52:81','http://183.207.228.22:80','http://183.207.228.41:80','http://183.207.228.52:80','http://183.207.228.52:84','http://183.207.228.52:85','http://183.207.228.54:82','http://183.207.228.58:80','http://183.207.228.9:81','http://183.207.228.9:82','http://183.207.228.9:90','http://183.207.229.137:7070','http://183.207.229.138:818','http://183.207.229.138:8000','http://183.207.229.138:8086','http://183.207.229.138:9001','http://200.109.230.139:80','http://202.43.191.114:3128','http://66.225.231.173:7808','http://111.161.126.98:80','http://117.169.64.4:80','http://117.79.64.84:80','http://120.198.243.111:80','http://120.198.243.50:80','http://120.198.243.78:80','http://120.198.243.79:80','http://125.24.79.197:80','http://182.93.228.134:8080','http://183.207.224.43:80','http://183.207.224.50:81','http://183.207.224.50:85','http://183.207.224.51:81','http://183.207.224.52:82','http://183.207.228.50:81','http://183.207.228.50:83','http://183.207.228.51:80','http://183.207.228.52:83','http://183.207.228.54:80','http://183.207.228.57:80','http://183.207.228.9:80','http://183.207.228.9:83','http://183.207.228.9:85','http://183.207.228.9:86','http://183.207.228.9:88','http://183.207.228.9:61616','http://183.207.229.137:80','http://183.207.229.137:818','http://183.207.229.137:8080','http://183.207.229.137:8888','http://183.207.229.137:9001','http://183.207.229.138:80','http://183.207.229.138:6969','http://183.207.229.138:7070','http://183.207.229.138:8088','http://183.207.229.138:8090','http://183.207.229.138:8888','http://183.207.229.138:9999','http://183.207.229.139:8090','http://183.89.225.240:3128','http://190.254.1.202:8080','http://200.93.41.61:9064','http://223.82.245.168:80','http://5.56.61.26:12313','http://101.4.136.34:9999','http://111.1.61.23:8080','http://111.12.128.171:9797','http://111.12.128.172:8080','http://111.12.128.172:8088','http://111.161.126.100:80','http://111.161.126.99:80','http://117.135.250.51:86','http://120.192.249.74:80','http://120.198.243.131:80','http://123.125.19.44:80','http://125.162.251.46:80','http://182.239.127.136:80','http://183.207.224.44:80','http://183.207.224.50:80','http://183.207.228.116:80','http://183.207.228.22:81','http://183.207.228.22:82','http://183.207.228.22:86','http://183.207.228.50:80','http://183.207.228.51:83','http://183.207.228.51:85','http://183.207.228.60:80','http://183.207.228.9:84','http://183.207.228.9:87','http://183.207.229.137:88','http://183.207.229.137:9090','http://183.207.229.137:9999','http://183.207.229.139:80','http://183.207.229.139:8088','http://183.207.229.15:80','http://183.207.229.19:82','http://183.207.237.18:80','http://200.109.230.140:80','http://222.73.233.134:80','http://111.12.128.166:80','http://111.12.128.171:83','http://111.12.128.171:8080','http://111.12.128.172:81','http://111.12.128.172:8085','http://116.50.25.181:8585','http://117.135.250.51:80','http://117.135.250.51:82','http://117.135.250.54:82','http://117.135.250.68:86','http://117.135.251.78:80','http://120.197.234.166:80','http://120.198.243.14:80','http://120.198.243.51:80','http://120.198.243.52:80','http://120.198.243.53:80','http://120.198.243.54:80','http://120.198.243.86:80','http://183.207.224.50:82','http://183.207.228.117:80','http://183.207.228.50:82','http://183.207.228.50:84','http://183.207.228.51:82','http://183.207.228.54:83','http://183.207.228.56:80','http://183.207.228.8:80','http://183.207.228.9:89','http://183.207.229.137:8000','http://183.207.229.137:8088','http://183.207.229.137:8089','http://183.207.229.138:8080','http://183.207.229.19:80','http://190.201.192.199:9064','http://190.52.192.1:8080','http://200.109.230.138:80','http://200.109.230.141:80','http://61.58.160.144:8088','http://77.245.156.112:25000','http://80.95.113.66:3128','http://111.1.36.133:80','http://111.12.128.135:80','http://111.12.128.171:9000','http://111.12.128.171:9064','http://117.135.250.55:81','http://117.135.250.56:80','http://117.135.251.75:82','http://117.135.251.78:82','http://119.110.81.101:3128','http://119.90.127.2:80','http://120.198.243.116:80','http://120.198.243.3:80','http://120.198.243.83:80','http://159.104.6.90:80','http://177.22.111.120:8080','http://177.84.241.107:3128','http://182.239.127.134:80','http://182.239.127.139:80','http://182.239.127.139:82','http://182.239.95.134:80','http://182.239.95.137:80','http://182.239.95.139:80','http://183.207.224.50:86','http://183.207.228.114:80','http://183.207.228.122:80','http://183.207.228.22:85','http://183.207.229.19:8081','http://183.207.237.18:83','http://183.61.240.126:80','http://189.89.159.122:64733','http://190.121.230.148:8080','http://202.28.120.10:8080','http://222.124.218.83:8080','http://36.250.74.88:8103','http://61.156.35.2:3128','http://61.19.30.198:8080','http://66.192.33.78:3128','http://89.175.89.22:3128','http://110.4.12.173:80','http://111.12.128.172:8089','http://111.13.12.202:80','http://117.135.250.11:80','http://117.135.250.54:80','http://117.135.250.55:80','http://117.135.251.74:80','http://117.135.251.76:80','http://119.203.38.159:3128','http://119.90.127.5:80','http://120.198.243.130:80','http://122.225.242.139:1337','http://183.207.228.115:80','http://183.207.228.22:83','http://183.207.229.137:6969','http://183.207.229.137:8001','http://183.207.229.138:8001','http://183.207.229.138:9090','http://183.207.229.139:88','http://186.116.8.170:8080','http://200.30.202.238:8080','http://202.119.25.69:9999','http://202.119.25.70:9999','http://202.154.23.89:80','http://202.77.115.71:54321','http://211.162.0.170:80','http://222.124.218.164:8080','http://46.229.139.77:3128','http://60.213.189.170:3988','http://61.156.3.166:80','http://61.53.143.179:80','http://61.54.221.200:3128','http://94.181.34.64:80','http://111.1.36.130:80','http://111.13.12.216:80','http://111.13.136.58:843','http://112.112.11.82:8080','http://113.214.13.1:8000','http://117.135.250.55:82','http://117.135.250.83:80','http://117.52.97.210:3128','http://118.174.10.193:3128','http://120.198.243.82:80','http://120.203.215.19:80','http://120.236.148.113:3128','http://123.125.114.167:80','http://124.88.67.13:843','http://182.239.127.139:81','http://183.207.229.130:83','http://183.207.229.19:81','http://183.224.1.30:80','http://202.106.16.36:3128','http://202.119.25.227:9999','http://202.119.25.71:9999','http://210.52.217.97:80','http://221.10.102.203:83','http://222.124.196.42:8080','http://222.73.233.135:80','http://222.73.233.136:80','http://49.50.96.71:8081','http://58.65.241.226:8080','http://101.71.27.27:8000','http://111.1.36.10:80','http://111.1.36.6:80','http://111.206.81.248:80','http://117.135.250.54:84','http://117.135.250.9:80','http://117.135.251.75:80','http://117.173.20.121:8123','http://118.163.165.250:3128','http://118.97.164.138:8080','http://119.6.144.74:82','http://119.6.144.74:843','http://124.95.163.102:80','http://175.43.20.95:80','http://180.153.100.242:80','http://183.207.224.13:80','http://183.207.228.42:80','http://183.207.229.130:82','http://183.207.229.17:80','http://183.207.237.11:80','http://183.207.237.18:81','http://189.89.159.122:26005','http://190.121.148.167:8080','http://202.138.248.64:3128','http://202.171.253.74:86','http://202.99.16.28:3128','http://218.207.195.206:8000','http://218.28.192.102:8118','http://218.59.144.120:80','http://219.246.65.143:3128','http://219.246.90.162:3128','http://221.12.173.130:3128','http://58.246.199.122:3128','http://58.251.78.71:8088','http://61.133.116.37:3128','http://61.163.165.250:9797','http://86.107.110.73:7808','http://91.196.48.196:9999','http://93.88.130.99:3128','http://101.71.27.120:80','http://111.12.128.167:80','http://111.12.128.172:80','http://111.13.65.125:80','http://111.206.50.177:80','http://113.207.130.166:80','http://120.131.128.214:80','http://120.198.243.118:80','http://120.198.243.15:80','http://139.0.25.146:8080','http://182.118.31.46:80','http://183.207.228.44:80','http://183.207.229.19:9090','http://189.89.159.122:46776','http://210.101.131.232:8080','http://218.207.195.206:8080','http://221.181.73.45:80','http://27.202.7.247:80','http://60.174.66.182:8118','http://61.184.192.42:80','http://110.4.12.178:80','http://111.13.65.124:80','http://114.255.183.164:8080','http://114.6.52.130:8080','http://114.80.182.132:80','http://115.239.210.199:80','http://119.6.144.74:83','http://125.88.215.120:80','http://180.153.100.242:86','http://183.207.228.119:80','http://183.207.237.18:86','http://188.237.185.202:8080','http://195.114.128.28:3128','http://202.138.233.145:8080','http://203.172.209.222:8080','http://218.59.144.120:81','http://220.181.32.106:80','http://221.130.199.222:80','http://221.193.249.140:3128','http://31.25.142.216:3128','http://41.33.224.4:8080','http://58.252.167.103:80','http://62.82.58.99:8080','http://101.69.180.85:80','http://109.224.45.205:8080','http://111.12.128.171:80','http://111.12.128.171:8060','http://111.40.196.68:80','http://113.30.162.85:9064','http://115.231.96.120:80','http://115.238.225.26:80','http://123.205.103.81:8088','http://124.248.190.220:8080','http://125.88.193.205:80','http://128.199.77.145:3128','http://180.153.100.242:84','http://182.239.127.137:80','http://182.93.224.126:8080','http://183.207.224.12:80','http://190.136.18.33:8090','http://202.102.27.72:80','http://202.119.25.72:9999','http://202.77.119.115:3128','http://209.177.93.6:80','http://218.27.136.164:8081','http://218.90.174.167:3128','http://221.130.199.224:80','http://223.86.66.223:8123','http://110.4.12.178:80','http://113.10.139.66:3128','http://14.199.114.63:8088','http://223.18.140.82:8088','http://203.169.246.37:3128','http://182.239.95.137:80','http://182.16.15.26:3128','http://182.239.127.139:80','http://113.10.136.18:3128','http://182.239.95.134:80','http://58.96.181.169:3128','http://58.96.179.120:3128','http://58.152.252.170:8088','http://182.239.127.139:81','http://182.16.15.28:3128','http://218.188.240.161:8118','http://103.246.244.161:44338','http://182.239.127.136:80','http://110.4.24.178:80','http://182.239.127.140:82','http://182.239.127.139:82','http://182.239.127.140:81','http://210.209.116.90:3128','http://61.93.246.50:8080','http://182.16.15.30:3128','http://218.188.16.123:8080','http://182.239.95.139:80','http://113.255.97.186:80','http://14.199.241.118:8088','http://182.239.127.137:80','http://113.10.138.20:8080','http://110.4.24.176:80','http://182.239.127.140:80','http://182.239.127.134:80','http://101.1.16.123:3128','http://110.4.12.173:80','http://182.239.95.136:80','http://123.1.175.43:8080','http://58.96.176.29:8888','http://49.1.245.242:3128','http://49.1.245.236:3128','http://222.122.60.46:3128','http://210.101.131.231:8080','http://183.86.209.117:3128','http://49.1.245.235:3128','http://119.203.38.159:3128','http://49.1.245.234:3128','http://49.1.245.233:3128','http://210.101.131.232:8080','http://165.132.27.110:8080','http://49.1.245.239:3128','http://49.1.245.238:3128','http://117.52.97.210:3128','http://49.1.245.237:3128','http://180.177.138.178:8088','http://123.110.105.61:8088','http://59.102.169.145:9064','http://140.125.47.102:9064','http://175.98.77.191:8088','http://58.115.146.46:9064','http://60.248.115.123:9064','http://60.248.53.19:9064','http://121.254.85.166:9064','http://60.248.109.228:8080','http://111.184.133.23:9064','http://180.177.167.189:9064','http://163.23.70.129:3128','http://182.235.184.16:8088','http://123.110.75.213:9064','http://210.66.166.36:8088','http://59.102.174.37:9064','http://223.26.77.44:9064','http://180.177.71.18:9064','http://114.33.236.112:9064','http://123.195.11.84:8088','http://219.69.108.117:9064','http://211.77.5.41:80','http://118.232.33.68:9064','http://60.250.81.118:80','http://118.163.165.250:3128','http://111.185.57.107:8088','http://36.233.237.240:8088','http://60.250.81.118:8080','http://211.77.5.41:3128','http://59.124.241.199:8080','http://182.234.238.192:8088','http://203.70.194.170:8080']
proxy_test(proxy_list)
